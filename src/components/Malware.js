import React, { useState } from "react";
import backlink from "../assets/background.mp4";
import { Link } from "react-router-dom";
import "@fortawesome/fontawesome-free/css/all.min.css";
import { CircularProgressbar, buildStyles } from "react-circular-progressbar";
import "react-circular-progressbar/dist/styles.css";
import { Chart as ChartJS, CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend } from "chart.js";

// Registering chart.js components
ChartJS.register(CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend);

export default function Home() {
    const [showDialog, setShowDialog] = useState(false);
    const [url, setUrl] = useState("");
    const [loading, setLoading] = useState(false);
    const [scanResult, setScanResult] = useState(null);

    const handleInputChange = (e) => {
        setUrl(e.target.value);
    };

    const handleScan = async () => {
        if (url) {
            setLoading(true);
            try {
                const response = await fetch(
                    `http://localhost:8080/api/v1/malware-scanner/scan?url=${url}`,
                    {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                        },
                    }
                );

                if (!response.ok) {
                    throw new Error("Failed to scan the website");
                }

                const result = await response.json();
                console.log(result);
                setScanResult(result);
                setShowDialog(true);
            } catch (error) {
                console.error("Error scanning the URL:", error);
                alert("Failed to scan the URL");
            } finally {
                setLoading(false);
            }
        }
    };
    return (
        <div className="App" style={{ height: "100vh", position: "relative" }}>
            <div className="hero" style={{ height: "100%", overflow: "hidden" }}>
                <div className="background-video">
                    <video autoPlay muted loop style={{ width: "100%", height: "100%", objectFit: "cover" }}>
                        <source src={backlink} type="video/mp4" />
                        Your browser does not support the video tag.
                    </video>
                </div>

                <div role="banner" className="nav-bar w-nav">
                    <div className="w-container">
                        <Link to="/" aria-current="page" className="brand-link w-nav-brand w--current">
                            <h1 className="logo">Vigilance Scan</h1>
                        </Link>
                        <nav role="navigation" className="nav-menu w-nav-menu">
                            <Link to="/contact" className="nav-link w-nav-link">
                                Contact
                            </Link>
                        </nav>
                        <nav role="navigation" className="nav-menu w-nav-menu">
                            <Link to="/malware" className="nav-link w-nav-link">
                                Malware
                            </Link>
                        </nav>
                        <nav role="navigation" className="nav-menu w-nav-menu">
                            <Link to="/" className="nav-link w-nav-link">
                                Vulnscan
                            </Link>
                        </nav>
                        <div className="menu-button w-clearfix w-nav-button">
                            <div className="menu-text">MENU</div>
                            <div className="menu-icon w-icon-nav-menu"></div>
                        </div>
                    </div>
                </div>

                <div className="hero-container w-container" style={{ marginTop: "50px" }}>
                    <h1 className="hero-heading">Unleash the Power of Malware Scanner</h1>
                    <div className="hero-subtitle">
                        Effortlessly Scan data from any website with our cutting-edge Malware scanner tool.
                    </div>
                </div>

                <div className="w-layout-hflex flex-block">
                    <div className="div-block">
                        <input
                            type="text"
                            className="url-input"
                            placeholder="Enter URL"
                            onChange={handleInputChange}
                        />
                        <div className="div-block-2" onClick={handleScan}>
                            <div className="arrow">
                                <i className="fa-solid fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>

                {loading && (
                    <div style={{ display: "flex", justifyContent: "center", alignItems: "center", height: "2%", position: "relative" }}>
                        <div style={{ width: "50px", height: "50px" }}>
                            <CircularProgressbar
                                value={66}
                                text={`Scanning...`}
                                styles={buildStyles({
                                    pathColor: "#3498db",
                                    textColor: "#3498db",
                                    trailColor: "#eee",
                                })}
                            />
                        </div>
                    </div>
                )}

                {showDialog && scanResult && (
                    <div
                        className="dialog-box"
                        style={{
                            width: "70%",
                            maxWidth: "500px",
                            height: "70%",
                            maxHeight: "500px",
                            margin: "auto",
                            padding: "20px",
                            backgroundColor: "#ffffff",
                            borderRadius: "10px",
                            position: "fixed",
                            top: "50%",
                            left: "50%",
                            transform: "translate(-50%, -50%)",
                            boxShadow: "0 4px 8px rgba(0, 0, 0, 0.1)",
                            overflow: "hidden",
                            display: "flex",
                            flexDirection: "column",
                        }}
                    >
                        <div
                            className="dialog-header"
                            style={{
                                display: "flex",
                                justifyContent: "space-between",
                                alignItems: "center",
                                marginBottom: "20px",
                            }}
                        >
                            <h2 style={{ fontSize: "25px", marginLeft: "50px" }}>
                                Scanning: <span style={{ color: "#3498db" }}>{url}</span>
                            </h2>
                            <button
                                onClick={() => setShowDialog(false)}
                                style={{
                                    backgroundColor: "#ff4c4c",
                                    color: "#fff",
                                    border: "none",
                                    borderRadius: "5px",
                                    padding: "5px 10px",
                                    cursor: "pointer",
                                }}
                            >
                                Close
                            </button>
                        </div>
                        <div>
                            <h3 style={{marginTop:"10px", marginBotttom:"10px"}}>Summary</h3>
                            <p>Target Url: {scanResult.targetURL}</p>
                            <p>Total Files Scanned: {scanResult.totalFilesScanned}</p>
                            <p>Total Infected Files: {scanResult.totalInfectedFiles}</p>
                            <p>Infected Files: {scanResult.infectedFiles}</p>
                          
                        </div>
                    </div>
                )}
            </div>
        </div>
    );
}
